"use strict";(self["webpackChunkstray_animal_rescue_system"]=self["webpackChunkstray_animal_rescue_system"]||[]).push([[940],{3940:function(e,t,s){s.r(t),s.d(t,{default:function(){return _}});var n=s(6252),i=s(3577);const l={style:{padding:"10px","margin-bottom":"50px"}},o=(0,n._)("div",{style:{"padding-bottom":"10px","border-bottom":"1px solid #ccc"}},[(0,n.Uk)("在线用户"),(0,n._)("span",{style:{"font-size":"12px"}},"（点击聊天气泡开始聊天）")],-1),c={key:0,style:{"font-size":"12px",color:"limegreen","margin-left":"5px"}},a={style:{width:"800px",margin:"0 auto","background-color":"white","border-radius":"5px","box-shadow":"0 0 10px #ccc"}},r={style:{"text-align":"center","line-height":"50px"}},d=["innerHTML"],p=(0,n._)("div",{style:{width:"100%",padding:"10px",border:"none","border-top":"1px solid #ccc","border-bottom":"1px solid #ccc",outline:"none"}},[(0,n._)("div",{id:"toolbar-container",style:{"z-index":"101"}}),(0,n._)("div",{id:"editor-container",style:{"z-index":"100","min-height":"300px"}})],-1),g={style:{"text-align":"right","padding-right":"10px"}},h=(0,n.Uk)("发送");function u(e,t,s,u,m,f){const v=(0,n.up)("chat-dot-round"),x=(0,n.up)("el-icon"),b=(0,n.up)("el-card"),y=(0,n.up)("el-col"),w=(0,n.up)("el-button"),k=(0,n.up)("el-row");return(0,n.wg)(),(0,n.iD)("div",l,[(0,n.Wm)(k,null,{default:(0,n.w5)((()=>[(0,n.Wm)(y,{span:2,offset:2},{default:(0,n.w5)((()=>[(0,n.Wm)(b,{style:{width:"300px",height:"300px",color:"#333"}},{default:(0,n.w5)((()=>[o,((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(m.users,(e=>((0,n.wg)(),(0,n.iD)("div",{style:{padding:"10px 0"},key:e.username},[(0,n._)("div",null,[(0,n._)("span",null,(0,i.zw)(e.username),1),(0,n.Wm)(x,{class:"el-icon-chat-dot-round",style:{"margin-left":"10px","font-size":"16px",cursor:"pointer"},onClick:t=>m.chatUser=e.username},{default:(0,n.w5)((()=>[(0,n.Wm)(v)])),_:2},1032,["onClick"]),e.username===m.chatUser?((0,n.wg)(),(0,n.iD)("span",c,"chatting...")):(0,n.kq)("",!0)])])))),128))])),_:1})])),_:1}),(0,n.Wm)(y,{span:20},{default:(0,n.w5)((()=>[(0,n._)("div",a,[(0,n._)("div",r," 医疗咨询室（"+(0,i.zw)(m.chatUser)+"） ",1),(0,n._)("div",{style:{height:"350px",overflow:"auto","border-top":"1px solid #ccc"},innerHTML:m.content},null,8,d),(0,n._)("div",null,[p,(0,n._)("div",g,[(0,n.Wm)(w,{type:"primary",size:"mini",onClick:f.send},{default:(0,n.w5)((()=>[h])),_:1},8,["onClick"])])])])])),_:1})])),_:1})])}var m=s(4471),f=s(7877);let v,x,b=null;var y={name:"Im",data(){return{circleUrl:"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png",vet:{},isCollapse:!1,users:[],chatUser:"",text:"",messages:[],content:"",vets:[],editorConfig:{placeholder:"请输入内容",MENU_CONF:{uploadImage:{server:"http://120.79.190.143:9090/files/editor/upload",fieldName:"file",base64LimitSize:5120}}}}},created(){this.init(),this.getVets()},mounted(){b=(0,f.Jh)({selector:"#editor-container",config:this.editorConfig,mode:"simple"}),v=(0,f.k5)({editor:b,selector:"#toolbar-container",mode:"simple"})},beforeUnmount(){null!=b&&b.destroy()},methods:{getVets(){m.Z.get("/vet/show").then((e=>{this.vets=e.data}));for(let e of this.vets)this.users.filter((t=>t.user!==e.nickName))},send(){if(this.text=b.getHtml(),this.chatUser)if(this.text)if("undefined"==typeof WebSocket)console.log("您的浏览器不支持WebSocket");else{console.log("您的浏览器支持WebSocket");let e={from:this.vet.nickName,to:this.chatUser,text:this.text};x.send(JSON.stringify(e)),this.messages.push({user:this.vet.nickName,text:this.text}),this.createContent(null,this.vet.nickName,this.text),this.text=""}else this.$message({type:"warning",message:"请输入内容"});else this.$message({type:"warning",message:"请选择聊天对象"})},createContent(e,t,s){let n;t?n='<div class="el-row" style="padding: 5px 0">\n  <div class="el-col el-col-22" style="text-align: right; padding-right: 10px">\n    <div class="tip left">'+s+'</div>\n  </div>\n  <div class="el-col el-col-2">\n  <span class="el-avatar el-avatar--circle" style="height: 40px; width: 40px; line-height: 40px;">\n    <img src="https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png" style="object-fit: cover;">\n  </span>\n  </div>\n</div>':e&&(n='<div class="el-row" style="padding: 5px 0">\n  <div class="el-col el-col-2" style="text-align: right">\n  <span class="el-avatar el-avatar--circle" style="height: 40px; width: 40px; line-height: 40px;">\n    <img src="https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png" style="object-fit: cover;">\n  </span>\n  </div>\n  <div class="el-col el-col-22" style="text-align: left; padding-left: 10px">\n    <div class="tip right">'+s+"</div>\n  </div>\n</div>"),console.log(n),this.content+=n},init(){this.vet=JSON.parse(sessionStorage.getItem("user")).vet;let e=this.vet.nickName,t=this;if("undefined"==typeof WebSocket)console.log("您的浏览器不支持WebSocket");else{console.log("您的浏览器支持WebSocket");let s="ws://localhost:9090/imserver/"+e;null!=x&&(x.close(),x=null),x=new WebSocket(s),x.onopen=function(){console.log("websocket已打开")},x.onmessage=function(s){console.log("收到数据===="+s.data);let n=JSON.parse(s.data);n.users?t.users=n.users.filter((t=>t.username!==e)):n.from===t.chatUser&&(t.messages.push(n),t.createContent(n.from,null,n.text))},x.onclose=function(){console.log("websocket已关闭")},x.onerror=function(){console.log("websocket发生了错误")}}},getProjectNum(){const e=new Date,t=e.getFullYear(),s=e.getMonth()+1,n=e.getDate();let i=String(t);return i+=s>=10?s:"0"+s,i+=n>=10?n:"0"+n,i}}},w=s(3744);const k=(0,w.Z)(y,[["render",u]]);var _=k}}]);
//# sourceMappingURL=940.b847c083.js.map