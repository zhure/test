"use strict";(self["webpackChunkstray_animal_rescue_system"]=self["webpackChunkstray_animal_rescue_system"]||[]).push([[904],{1904:function(e,t,s){s.r(t),s.d(t,{default:function(){return S}});var n=s(6252),l=s(3577);const i={style:{padding:"10px","margin-bottom":"50px"}},o=(0,n._)("div",{style:{"padding-bottom":"10px","border-bottom":"1px solid #ccc"}},[(0,n.Uk)("在线用户"),(0,n._)("span",{style:{"font-size":"12px"}},"（点击聊天气泡开始聊天）")],-1),a={key:0},c={key:0,style:{"font-size":"12px",color:"limegreen","margin-left":"5px"}},r={style:{width:"800px",margin:"0 auto","background-color":"white","border-radius":"5px","box-shadow":"0 0 10px #ccc"}},d={style:{"text-align":"center","line-height":"50px"}},p=["innerHTML"],g=(0,n._)("div",{style:{width:"100%",padding:"10px",border:"none","border-top":"1px solid #ccc","border-bottom":"1px solid #ccc",outline:"none"}},[(0,n._)("div",{id:"toolbar-container",style:{"z-index":"101"}}),(0,n._)("div",{id:"editor-container",style:{"z-index":"100","min-height":"300px"}})],-1),h={style:{"text-align":"right","padding-right":"10px"}},u=(0,n.Uk)("发送");function m(e,t,s,m,v,x){const f=(0,n.up)("chat-dot-round"),y=(0,n.up)("el-icon"),b=(0,n.up)("el-card"),w=(0,n.up)("el-col"),k=(0,n.up)("el-button"),_=(0,n.up)("el-row");return(0,n.wg)(),(0,n.iD)("div",i,[(0,n.Wm)(_,null,{default:(0,n.w5)((()=>[(0,n.Wm)(w,{span:2,offset:2},{default:(0,n.w5)((()=>[(0,n.Wm)(b,{style:{width:"300px",height:"300px",color:"#333"}},{default:(0,n.w5)((()=>[o,((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(v.users,(e=>((0,n.wg)(),(0,n.iD)("div",{style:{padding:"10px 0"},key:e.username},[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(v.vets,(t=>((0,n.wg)(),(0,n.iD)("div",null,[e.username===t.nickName?((0,n.wg)(),(0,n.iD)("div",a,[(0,n._)("span",null,(0,l.zw)(e.username),1),(0,n.Wm)(y,{class:"el-icon-chat-dot-round",style:{"margin-left":"10px","font-size":"16px",cursor:"pointer"},onClick:e=>x.chat(t)},{default:(0,n.w5)((()=>[(0,n.Wm)(f)])),_:2},1032,["onClick"]),e.username===v.chatUser?((0,n.wg)(),(0,n.iD)("span",c,"chatting...")):(0,n.kq)("",!0)])):(0,n.kq)("",!0)])))),256))])))),128))])),_:1})])),_:1}),(0,n.Wm)(w,{span:20},{default:(0,n.w5)((()=>[(0,n._)("div",r,[(0,n._)("div",d," 医疗咨询室（"+(0,l.zw)(v.chatUser)+"） ",1),(0,n._)("div",{style:{height:"350px",overflow:"auto","border-top":"1px solid #ccc"},innerHTML:v.content},null,8,p),(0,n._)("div",null,[g,(0,n._)("div",h,[(0,n.Wm)(k,{type:"primary",size:"mini",onClick:x.send},{default:(0,n.w5)((()=>[u])),_:1},8,["onClick"])])])])])),_:1})])),_:1})])}var v=s(4471),x=s(7877);let f,y,b=null;var w={name:"Medical",data(){return{circleUrl:"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png",user:{},isCollapse:!1,users:[],chatUser:"",text:"",messages:[],content:"",vets:[],editorConfig:{placeholder:"请输入内容",MENU_CONF:{uploadImage:{server:"http://120.79.190.143:9090/files/editor/upload",fieldName:"file",base64LimitSize:5120}}}}},created(){this.init(),this.getVets()},mounted(){b=(0,x.Jh)({selector:"#editor-container",config:this.editorConfig,mode:"simple"}),f=(0,x.k5)({editor:b,selector:"#toolbar-container",mode:"simple"})},beforeUnmount(){null!=b&&b.destroy()},methods:{getVets(){v.Z.get("/vet/show").then((e=>{this.vets=e.data}))},chat(e){this.chatUser=e.nickName;let t='<div class="el-row" style="padding: 5px 0">\n  <div class="el-col el-col-2" style="text-align: right">\n  <span class="el-avatar el-avatar--circle" style="height: 40px; width: 40px; line-height: 40px;">\n    <img src=" '+e.headImg+'" style="object-fit: cover;">\n  </span>\n  </div>\n  <div class="el-col el-col-22" style="text-align: left; padding-left: 10px">\n    <div >\n      <span style="display: block">名称：'+e.nickName+'</span>\n      <span style="display: block">描述：'+e.vetDescribe+'</span style="display: block">\n</div>\n  </div>\n</div>';this.content=t},send(){if(this.text=b.getHtml(),this.chatUser)if(this.text)if("undefined"==typeof WebSocket)console.log("您的浏览器不支持WebSocket");else{console.log("您的浏览器支持WebSocket");let e={from:this.user.username,to:this.chatUser,text:this.text};y.send(JSON.stringify(e)),this.messages.push({user:this.user.username,text:this.text}),this.createContent(null,this.user.username,this.text),this.text=""}else this.$message({type:"warning",message:"请输入内容"});else this.$message({type:"warning",message:"请选择聊天对象"})},createContent(e,t,s){let n;t?n='<div class="el-row" style="padding: 5px 0">\n  <div class="el-col el-col-22" style="text-align: right; padding-right: 10px">\n    <div class="tip left">'+s+'</div>\n  </div>\n  <div class="el-col el-col-2">\n  <span class="el-avatar el-avatar--circle" style="height: 40px; width: 40px; line-height: 40px;">\n    <img src="https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png" style="object-fit: cover;">\n  </span>\n  </div>\n</div>':e&&(n='<div class="el-row" style="padding: 5px 0">\n  <div class="el-col el-col-2" style="text-align: right">\n  <span class="el-avatar el-avatar--circle" style="height: 40px; width: 40px; line-height: 40px;">\n    <img src="https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png" style="object-fit: cover;">\n  </span>\n  </div>\n  <div class="el-col el-col-22" style="text-align: left; padding-left: 10px">\n    <div class="tip right">'+s+"</div>\n  </div>\n</div>"),console.log(n),this.content+=n},init(){sessionStorage.getItem("user")?this.user=JSON.parse(sessionStorage.getItem("user")):this.user.username=this.getProjectNum()+Math.floor(1e4*Math.random());let e=this.user.username,t=this;if("undefined"==typeof WebSocket)console.log("您的浏览器不支持WebSocket");else{console.log("您的浏览器支持WebSocket");let s="ws://120.79.190.143:9090/imserver/"+e;null!=y&&(y.close(),y=null),y=new WebSocket(s),y.onopen=function(){console.log("websocket已打开")},y.onmessage=function(s){console.log("收到数据===="+s.data);let n=JSON.parse(s.data);n.users?t.users=n.users.filter((t=>t.username!==e)):n.from===t.chatUser&&(t.messages.push(n),t.createContent(n.from,null,n.text))},y.onclose=function(){console.log("websocket已关闭")},y.onerror=function(){console.log("websocket发生了错误")}}},getProjectNum(){const e=new Date,t=e.getFullYear(),s=e.getMonth()+1,n=e.getDate();let l=String(t);return l+=s>=10?s:"0"+s,l+=n>=10?n:"0"+n,l}}},k=s(3744);const _=(0,k.Z)(w,[["render",m]]);var S=_}}]);
//# sourceMappingURL=904.4dd22505.js.map